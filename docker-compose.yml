services:
  ghost-browser:
    build: .
    image: ghost-chrome-runner
    # FORCE AMD64: Google Chrome only exists for x86_64 linux
    platform: linux/amd64
    container_name: ghost-browser
    ports:
      - "3000:3000"
      - "9222:9222"
    volumes:
      - chrome_data:/data/chrome-profile
    environment:
      - CHROME_ARGS=--window-size=1920,1080
      # Auto-shutdown after 300 seconds (5 mins) of inactivity
      # Set to 0 to disable
      - IDLE_TIMEOUT=300
    shm_size: '2gb'
    # Restart only if it crashes, NOT if we exit cleanly (idle timeout)
    restart: on-failure

volumes:
  chrome_data:
